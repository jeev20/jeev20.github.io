{
  "hash": "077e2c9d1720e92b270db63c91822540",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: Updating Ollama in an airgapped linux server\ndescription: \"A walkthrough\"\nformat: html\ntoc: true\nlang: en\njupyter: python3\nipynb-shell-interactivity: all\nexecute:\n  echo: false\ndate: 2025-02-17 15:01 +0100\ncategories: [\"llm\"]\ntags: [\"ollama\", \"airgapped\"]\ncomments:\n  giscus:\n    repo: jeev20/jeev20.github.io\n---\n\n\n\n> Case: Updating Ollama installation in a local server without internet access \n\n\n\n**TL;DR** \n```{.bash}\nsudo rm -rf /usr/lib/ollama \ncurl -L https://ollama.com/download/ollama-linux-amd64.tgz -o ollama-linux-amd64.tgz\nsudo tar -C /usr -xzf ollama-linux-amd64.tgz \nollama serve\nollama -v\n```\n\n\n\nAt work this week I had to update an Ollama instance in a airgapped linux server. The machine only had local ssh access. Thankfully ollama docs explained this scenario well. \n\n## Step 1 - Remove previous install\n`sudo rm -rf /usr/lib/ollama` --> removes the previous Ollama installation. This can also remove the downloaded models unless you do the following.\n\nPreviously, to make our downloaded models independent of the Ollama version, I set an environment variable `OLLAMA_MODELS` such that Ollama can get static models from a shared drive. This made sure that when we do have to update Ollama, we do not need to purge already downloaded models. \nBy default the downloaded models are saved at \n\n```{.plaintext}\nmacOS: ~/.ollama/models\nLinux: /usr/share/ollama/.ollama/models\nWindows: C:\\Users\\%username%\\.ollama\\models\n```\n\n\n\nThe following command would set OLLAMA_MODELS to the users home folder `/home/$user/OllamaModels`\n\n```{.bash}\nexport OLLAMA_MODELS=\"/home/$user/OllamaModels\"\n```\n\nAnother way to set `OLLAMA_MODELS` path is to edit the `/etc/systemd/system/ollama.service` file as show in this [walkthrough](https://github.com/ollama/ollama/blob/main/docs/linux.md)\n\n## Step 2 - Download the specific version \n\n`curl -L https://ollama.com/download/ollama-linux-amd64.tgz -o ollama-linux-amd64.tgz`command downloads the latest version of Ollama to the current folder.\nOne can also download the same via the github releases page: [Ollama Releases](https://github.com/ollama/ollama/releases)\n\n\n## Step 3 - Extract contents and copy \n`sudo tar -C /usr -xzf ollama-linux-amd64.tgz` command extracts the contents and copies it to `/usr` folder. \n\n## Step 4 - Check the installation\n`ollama serve` starts the ollama service if it is not already running\n`ollama -v` outputs the version of the new version. For example : `ollama version is 0.5.7`\n`ollama list` will then output all of your previously downloaded models.\n\n\n\n## References\n\n* [Ollama linux installing manually](https://github.com/ollama/ollama/blob/main/docs/linux.md)\n* [Ollama general FAQ](https://github.com/ollama/ollama/blob/main/docs/faq.md)\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {}
  }
}